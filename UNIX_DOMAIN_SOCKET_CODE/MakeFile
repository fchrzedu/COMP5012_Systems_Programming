# Compiler
CC = clang
CFLAGS = -Wall -Wextra -std=c99
LDFLAGS = -L. -lsharedlib -Wl,-rpath=.

# Output files
DAEMON = daemon
CLIENT = client
SHAREDLIB = libsharedlib.so

# Source files
DAEMON_SRC = daemon.c
CLIENT_SRC = client.c
SHAREDLIB_SRC = sharedlib.c

# Default target
all: $(DAEMON) $(SHAREDLIB) $(CLIENT)

# Build daemon
$(DAEMON): $(DAEMON_SRC)
	$(CC) $(CFLAGS) -o $(DAEMON) $(DAEMON_SRC)

# Build shared library
$(SHAREDLIB): $(SHAREDLIB_SRC) sharedlib.h
	$(CC) $(CFLAGS) -fPIC -shared -o $(SHAREDLIB) $(SHAREDLIB_SRC)

# Build client
$(CLIENT): $(CLIENT_SRC) sharedlib.h $(SHAREDLIB)
	$(CC) $(CFLAGS) -o $(CLIENT) $(CLIENT_SRC) $(LDFLAGS)

# Clean build files
clean:
	rm -f $(DAEMON) $(CLIENT) $(SHAREDLIB)

# Run daemon
run-daemon: $(DAEMON)
	./$(DAEMON) &

# Run client
run-client: $(CLIENT)
	./$(CLIENT)

.PHONY: all clean run-daemon run-client
